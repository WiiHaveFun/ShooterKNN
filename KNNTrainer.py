from sklearn.neighbors import KNeighborsRegressor
from sklearn.multioutput import MultiOutputRegressor
import numpy as np
import pickle


# Distance dataset
# Input (meters)
# distance = np.array([[2.0], [2.25], [2.5], [2.75], [3.0], [3.25], [3.5], [3.7], 
#                      [4.0], [4.3], [4.6], [4.8], [5.0], [5.2], [5.5], [5.75], 
#                      [6.0], [6.3], [6.5], [6.8], [7.0], [7.3], [7.5], [7.8], 
#                      [8.0], [8.2], [8.5], [9.0], [9.6], [10.0], [10.5], [10.8]])

# Good
# distance = np.array([[1.05], [1.80], [2.00], [2.21], [2.42], [2.61], [2.84],
#                      [3.03], [3.30], [3.58], [3.82], [4.02], [4.32],
#                      [4.56], [5.04], [5.44], [5.64], [5.90], [6.21],
#                      [6.40], [6.66], [7.01]])

distance = np.array([[3.72], [4.13], [4.47], [4.83]])


# Output
# Shooter speed (RPM), Hood angle (deg)
# output = np.array([[3000, 80], [3000, 75], [3000, 70], [3000, 65], [3300, 60], [3300, 57], [3300, 56], [3300, 55], 
#                    [3300, 54], [3300, 53], [3600, 53], [3600, 52], [3600, 51], [3700, 51], [3700, 50], [3800, 50], 
#                    [3800, 49], [3900, 49], [3900, 48], [3900, 47], [4100, 47], [4200, 47], [4200, 47], [4400, 47], 
#                    [4400, 46], [4500, 46], [4600, 46], [4700, 45], [4800, 45], [4900, 45], [5000, 45], [5600, 30]])

# Good
# output = np.array([[2250, 1999], [2300, 1824], [2350, 1670], [2400, 1590], [2450, 1508], [2500, 1452], [2550, 1408],
#                    [2600, 1364], [2650, 1316], [2700, 1305], [2750, 1223], [2800, 1202], [2850, 1170],
#                    [3000, 1073], [3100, 1020], [3200, 861],  [3300, 757],  [3400, 595],  [3600, 482],
#                    [3800, 330],  [4200, 90],   [4400, 0]])

output = np.array([[4000, 577], [4000, 500], [4000, 492], [4000, 385]])

# Verification set
# distance2 = np.array([[3.0], [3.2], [3.4], [3.6], [3.8], [4.0], [4.2], [4.4], [4.6], 
#                       [4.8], [5.0], [5.2], [5.4], [5.6], [5.8], [6.0], [6.2], [6.4], 
#                       [6.6], [6.8], [7.0], [7.2], [7.4], [7.6], [7.8], [8.0], [8.2], 
#                       [8.4], [8.6], [8.8], [9.0], [9.2], [9.4], [9.6], [9.8], [10.0]])

distance2 = np.array([[3.0], [3.2], [3.4], [3.6], [3.8], [4.0], [4.2], [4.4], [4.6], 
                      [4.8], [5.0], [5.2], [5.4], [5.6], [5.8], [6.0], [6.2], [6.4], 
                      [6.6], [6.8]])

knn = KNeighborsRegressor(n_neighbors=2, weights='distance', algorithm='auto', 
                          leaf_size=30, p=2, metric='minkowski', metric_params=None, 
                          n_jobs=None)

regr = MultiOutputRegressor(knn)

regr.fit(distance, output)

output2 = regr.predict(distance2)

print(output2)

filename = 'shooterModel.sav'
pickle.dump(regr, open(filename, 'wb'))